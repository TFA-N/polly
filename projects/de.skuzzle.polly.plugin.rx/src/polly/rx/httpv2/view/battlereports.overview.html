<div class="highlight contentBox">
    #CONTENT_HEADER ("Statistics for shown reports")
    <p class="content highlight" style="text-align:center;padding:0px;margin:10px;">
        <b>How To:</b> Adjust filter settings below, then click 
        <input type="button" class="button" value="Reload" onclick="loadStats()"/>
        to recalculate statistics for the shown reports.
    </p>
    <div class="content" style="display:none" id="statistics"></div>
</div>
<div class="highlight contentBox">
    #CONTENT_HEADER ("All Battlereports")
    <div class="content">
        <table id="reports">
        </table>
    </div>
</div>
<div class="highlight contentBox">
    #CONTENT_HEADER ("Post new report")
    <div class="content">
    <form id="postReport">
	    <textarea name="report" style="width: 100%;height:250px;"></textarea>
	    <input type="button" value="Submit" onclick="submitReport()"/>
    </form>
    <p style="text-align: right;"><a href="$PAGE_INSTALLLIVEKB">Install</a> Greasemonkey Script.</p>
    </div>
</div>
<script>
$(document).ready(function() {
	loadTable("/api/allReports", "reports");
});

function loadStats() {
    showProgress();
    $.get("/api/battlereportStatistics", function(data) {
        $("#statistics").html(data);
        $("#statistics").fadeIn();
        stopProgress();
    });
}

function deleteReport(id) {
	var del = confirm("Really delete this report?");
	if (!del) {
		return;
	}
	$.get("$PAGE_DELETEREPORT?reportId="+id, function(data) {
		location.reload();
	})
}

function submitReport() {
	$.post("$PAGE_POSTREPORT", $("#postReport").serialize(), function(data) {
		var result = JSON.parse(data);
		if (!result.success) {
			alert(result.message);
			$("#postReport textarea").select();
		} else {
			$("#postReport textarea").val("");
			location.reload();
		}
	})
}
</script>