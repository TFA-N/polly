#set ($dir = !$dir)

#if ($reports.size() != 0)
<h3>Total drop for shown reports</h3>
<table>
	<tr>
	#foreach ($drop in $totalDrop)
		<th>$!drop.getRessource()</th>
	#end
	</tr>
    <tr>
        <th colspan="14">Total drop</th>
    </tr>
	<tr>
	#foreach ($drop in $totalDrop)
		<td style="text-align:right;">$!drop.getAmount()</td>
	#end
	</tr>
    <tr>
        <th colspan="14">Average drop</th>
    </tr>
	<tr>
	#foreach ($drop in $totalDrop)
#set ($ratio = $drop.getAmount()/$reports.size())
		<td style="text-align:right;">$!ratio</td>
	#end
	</tr>
    <tr>
        <th colspan="14">Max drop</th>
    </tr>
	<tr>
	#foreach ($drop in $dropMax)
		<td style="text-align:right;">$!drop.getAmount()</td>
	#end
	</tr>
    <tr>
        <th colspan="14">Min drop</th>
    </tr>
	<tr>
	#foreach ($drop in $dropMin)
		<td style="text-align:right;">$!drop.getAmount()</td>
	#end
	</tr>
</table>

<p>
<b>Artifacts:</b> $artifacts<br/>
<b>Chance:</b> $myPolly.formatting().formatNumber($chance)
</p>

<h3>Statistics for shown reports</h3>
<table style="width:auto">
    <tr>
        <th>Average defender KW</th>
        <td style="text-align:right;">$myPolly.formatting().formatNumber($kwDefender)</td>
    </tr>
    <tr>
        <th>Total defender Captain XP</th>
        <td style="text-align:right;">$!capiXpSumDefender</td>
    </tr>
    <tr>
        <th>Total defender Crew XP</th>
        <td style="text-align:right;">$!crewXpSumDefender</td>
    </tr>
    <tr>
        <th>Total defender PZ damage </th>
        <td style="text-align:right;">$!pzDamageDefender</td>
    </tr>
    <tr>
        <th>Total defender repair time</th>
        <td style="text-align:right;">$myPolly.formatting().formatTimeSpan($repairTimeDefender)</td>
    </tr>
    <tr>
        <th>Total defender repair costs</th>
        <td>
            <table>
                <tr>
                #foreach ($i in $repairCostDefender)
                    <th>$!i.getRessource()</th>
                #end
                </tr>
                <tr>
                #foreach ($i in $repairCostDefender)
                    <td>$!i.getAmount()</th>
                #end
                </tr>
            </table>
        </td>
    </tr>
</table>

<table style="width:auto;">
    <tr>
        <th>Average attacker KW</th>
        <td style="text-align:right;">$myPolly.formatting().formatNumber($kwAttacker)</td>
    </tr>
    <tr>
        <th>Total attacker Captain XP</th>
        <td style="text-align:right;">$!capiXpSumAttacker</td>
    </tr>
    <tr>
        <th>Total attacker Crew XP</th>
        <td style="text-align:right;">$!crewXpSumAttacker</td>
    </tr>
    <tr>
        <th>Total attacker PZ damage </th>
        <td style="text-align:right;">$!pzDamageAttacker</td>
    </tr>
    <tr>
        <th>Total attacker repair time</th>
        <td style="text-align:right;">$myPolly.formatting().formatTimeSpan($repairTimeAttacker)</td>
    </tr>
    <tr>
        <th>Total attacker repair costs</th>
        <td>
            <table>
                <tr>
                #foreach ($i in $repairCostAttacker)
                    <th>$!i.getRessource()</th>
                #end
                </tr>
                <tr>
                #foreach ($i in $repairCostAttacker)
                    <td>$!i.getAmount()</th>
                #end
                </tr>
            </table>
        </td>
    </tr>
</table>
#else
<h3>No battlereport matches your current filter settings.</h3>
#end

<h3>Active Filters</h3>
<table style="width: auto;">
    <tr>
        <th>Filter type</th>
        <th>Filter value</th>
        <th>Negate</th>
        <th>Settings</th>
        <th>Hint</th>
    </tr>
    <tr>
        <td>Chaining method:</td>
        <td>$FILTER_SETTINGS.getChainingMethod()</td>
        <td>-</td>
        <td><a href="filter_reports?action=or">OR</a> | <a href="filter_reports?action=and">AND</a></td>
        <td>Whether each of the filter below must match (and) or at least one filter must match (or)</td>
    </tr>
    <tr>
        <td>Switch alien Attacks</td>
        <td>$FILTER_SETTINGS.isSwitchOnAlienAttack()</td>
        <td>-</td>
        <td><a href="filter_reports?action=toggleSwitching">Toggle</a></td>
        <td>Switching this to true causes switching of the defender and attacker values in alien attacks for the purpose of the statistical values above.</td>
    </tr>
    #foreach ($entry in $FILTER_SETTINGS.getFilters())
    <tr>
        <td>Dynamic filter</td>
        <td>$entry.toString()</td>
        <td>$entry.isNegate()</td>
        <td><a href="filter_reports?action=removeFilter&filterId=$entry.getId()">Remove</a> | <a href="filter_reports?action=negate&filterId=$entry.getId()">Negate</a></td>
        <td>$entry.getHint()</td>
    </tr>
    #end
    <tr>
        <td></td>
        <td></td>
        <td></td>
        <td><a href="filter_reports?action=clear">Clear all Filters</a></td>
        <td></td>
    </tr>
</table>

<h3>More Filters</h3>
<table>
    <tr>
        <th>Attacker is</th>
        <th>Defender is</th>
        <th>Involved venad is</th>
        <th>Attacker clan is</th>
        <th>Defender clan is</th>
        <th>Location is</th>
        <th>Date is</th>
    </tr>
    <tr>
        <td>#foreach ($v in $venads) <a href="filter_reports?action=addFilter&filterKey=ATTACKER_FILTER&param=$v">$v #end</td>
        <td>#foreach ($v in $venads) <a href="filter_reports?action=addFilter&filterKey=DEFENDER_FILTER&param=$v">$v</a> #end</td>
        <td>#foreach ($v in $venads) <a href="filter_reports?action=addFilter&filterKey=ANY_VENAD_FILTER&param=$v">$v</a> #end</td>
        <td>#foreach ($c in $clans) <a href="filter_reports?action=addFilter&filterKey=ATTACKER_CLAN_FILTER&param=$c">$c</a> #end</td>
        <td>#foreach ($c in $clans) <a href="filter_reports?action=addFilter&filterKey=DEFENDER_CLAN_FILTER&param=$c">$c</a> #end</td>
        <td>#foreach ($l in $locations) <a href="filter_reports?action=addFilter&filterKey=LOCATION_FILTER&param=$l">$l</a> #end</td>
        <td>#foreach ($d in $dates) <a href="filter_reports?action=addFilter&filterKey=DATE_FILTER&param=$myPolly.formatting().formatDate($d)">$dateFormat.format($d)</a> #end</td>
    </tr>
</table>



#if ($sortKey && $reports)
    $sorter.sort($reports, $sortKey, $dir)
#end


<h3>Reports ($!reports.size())</h3>
<p style="font-size:xx-small; font-weight:bold">(Click Id for detailed info)</p>

<form action="filter_reports" method="POST">
<input type="hidden" name="action" value="idSelect"/>
<input type="submit" value="Statistic for selected" name="select" class="button"/>
<input type="submit" value="Delete selected" name="delete" class="button"/>
<table>
	<tr>
        <th><input type="checkbox" name="blah" disabled></th>
		<th><a href="$target&sortKey=getId&dir=$dir">Id</a></th>
		<th><a href="$target&sortKey=getQuadrant&dir=$dir">Quadrant</a></th>
		<th><a href="$target&sortKey=getAttackerVenadName&dir=$dir">Attacker</a></th>
		<th><a href="$target&sortKey=getAttackerClan&dir=$dir">Attacker Clan</a></th>
		<th><a href="$target&sortKey=getAttackerKw&dir=$dir">Attacker KW/Xp-Mod</a></th>
		<th><a href="$target&sortKey=getDefenderVenadName&dir=$dir">Defender</a></th>
		<th><a href="$target&sortKey=getDefenderClan&dir=$dir">Defender Clan</a></th>
		<th><a href="$target&sortKey=getDefenderKw&dir=$dir">Defender KW/Xp-Mod</a></th>
		<th><a href="$target&sortKey=getTactic&dir=$dir">Tactic</a></th>
		<th><a href="$target&sortKey=hasArtifact&dir=$dir">Artifact</a></th>
		<th><a href="$target&sortKey=getDate&dir=$dir">Date</a></th>
	</tr>
    #set ($i = 0)
	#foreach ($report in $reports)
        #set ($i = $i+1)
	<tr>
        <td><input type="checkbox" value="$report.getId()" name="selectRP"/></td>
        <td>$i</td>
		<td><a href="battlereport_info?id=$report.getId()">$report.getId()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=LOCATION_FILTER&param=$report.getQuadrant()">$report.getQuadrant()</a> $report.getX(),$report.getY()</td>
		<td><a href="filter_reports?action=addFilter&filterKey=ATTACKER_FILTER&param=$report.getAttackerVenadName()">$report.getAttackerVenadName()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=ATTACKER_CLAN_FILTER&param=$report.getAttackerClan()">$!report.getAttackerClan()</a></td>
		<td>$myPolly.formatting().formatNumber($report.getAttackerKw()) / $myPolly.formatting().formatNumber($report.getAttackerXpMod())</td>
		<td><a href="filter_reports?action=addFilter&filterKey=DEFENDER_FILTER&param=$report.getDefenderVenadName()">$report.getDefenderVenadName()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=DEFENDER_CLAN_FILTER&param==$report.getDefenderClan()">$!report.getDefenderClan()</a></td>
		<td>$myPolly.formatting().formatNumber($report.getDefenderKw()) / $myPolly.formatting().formatNumber($report.getDefenderXpMod())</td>
		<td><a href="filter_reports?action=addFilter&filterKey=TACTIC_FILTER&param=$report.getTactic()">$report.getTactic()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=HAS_ARTIFACT_FILTER">$report.hasArtifact()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=DATE_FILTER&param=$myPolly.formatting().formatDate($report.getDate())">$myPolly.formatting().formatDate($report.getDate())</a></td>
	</tr>
	#end
</table>
<input type="submit" value="Statistic for selected" name="select" class="button"/>
<input type="submit" value="Delete selected" name="delete" class="button"/>
</form>