<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Polly Webinterface v2</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <style type="text/css">
        * {
            margin: 0px;
            padding: 0px;
            font-family: Helvetica, Verdana, Arial, Georgia, Serif;
        }
        
        body {
            background: white;
        }
        
        #header {
            width: 100%;
            height: 100px;
            background: #20BCFF;
            border-bottom: 3px solid #2F99FF;
        }
        
        #header a {
            text-decoration: none;
            color: #E6F9FF;
        }
        
        #header h1 {
            color: #E6F9FF;
            font-variant: small-caps;
            text-align: center;
            padding-top: 25px;
        }
        
        #login {
            background: #78E4FF;
            float: left;
            display: none;
        }
        
        #status {
            display: none;
            float: left;
            font-size: small;
            font-weight: bold;
            color: #E6F9FF;
        }

        ul#menu li#working {
            display: none;
            background: #E6F9FF; 
            color: black; 
            font-size:x-small;
            float: right;
        }

        
        ul#menu {
            list-style-type: none; 
            height: 25px;
            line-height: 25px;
            width: 100%;
            background: #E6F9FF;
            border-bottom: 1px solid #2F99FF;
        }
        
        ul#menu li {
            float: left; 
            height: 25px;
            padding-right: 10px;
            padding-left: 10px;
        }
        
        ul#menu a {
            text-decoration: none;
            color: black;
            font-weight: bold;
            font-size: small;
        }
        
        ul#menu li:hover {
            display: block;
            text-decoration: none;
            background: #78E4FF;
        }
        
        
        
        #content {
            margin: 50px;
            font-size: small;
        }
        
        
        #content h2,h3,h4 {
            color: #000088;
            margin-bottom: 15px;
            margin-top: 25px;
        }
        
        
        #content table {
            border-collapse: collapse;
            width: 100%;
            font-size: small;
        }
        
        #content table td,th {
            border: 1px solid #78E4FF;
            padding-left: 5px;
        }
        
        #content table th {
            color: black;
            background: #20BCFF;
        }
        
        #content table tr:hover {
        background: #20BCFF;
        }
        
        #content table th a,a:visited,a:active {
            color: black;
            text-decoration: none;
        }
        
        #content tr:nth-child(even) {
            background-color: #E6F9FF;
        }
    </style>
    <script>
        var content = "content/status";
        
        function toggleWorking() {
            $("#working").fadeToggle('fast');
        }
        
        
        function updateContent(url) {
            toggleWorking();
            $("#content").hide();
            $.get(url, function(data) {
                content = url;
                $("#content").html(data);
                $("#content").fadeIn();
                toggleWorking();
            });
        }
        
        
        function updateStatus(result) {
            $("#status").html("<input type=\"button\" value=\"Logout " + 
                result.name + "\" onclick=\"performLogout()\"/> Logout in " + 
                result.timeLeft
            );
        }
        
        
        
        function checkLoggedIn() {
            $.get("api/checkLogin", function(data) {
                var result = JSON.parse(data);
                if (result.loggedIn) {
                    $("#login").hide();
                    $("#menu").show();
                    $("#status").show();
                    updateStatus(result);
                } else {
                    $("#login").show();
                    $("#status").hide();
                    $("#menu").hide();
                }
            });
        }
        
        
        
        function renderMenu(result) {
            $("#menu").empty();
            var content = "";
            $.each(result.menu, function() {
                content += "<li><a href=\"#\" onclick=\"updateContent('" + this.url + "')\">" + this.name + "</a></li>\n"
            });
            content += "<li id=\"working\">Refreshing...<img style=\"vertical-align:middle;\" src=\"files/img/reload.gif\"/></li>";
            $("#menu").html(content);
        }
        

        
        function performLogin() {
            $("#content").hide();
            $.post("api/login", $("#loginForm").serialize(), function(data) {
                var result = JSON.parse(data);
                if (result.success) {
                    $("#login").fadeOut('fast', function() {
                        $("#status").fadeIn('fast');
                        renderMenu(result);
                        $("#menu").fadeIn('fast');
                        updateContent(result.contentPage);
                    });
                } else {
                    alert("Login failed");
                }
            });
        }
        
        
        
        function performLogout() {
            $.get("api/logout", function(data) {
                $("#content").fadeOut('fast', function() {
                    $("#status").fadeOut('fast');
                    $("#login").fadeIn('fast');
                    $("#menu").fadeOut('fast');
                });
            });
        }

        
        
        $(document).ready(checkLoggedIn);
        $(document).ready(function() {
            $("#performLogin").click(function(event) {
                event.preventDefault();
                performLogin();
            });
        });
        $(document).keydown(function(e) {
            // F5 pressed
            if (e.which == 116) {
                e.preventDefault();
                updateContent(content);
                checkLoggedIn();
            }
        });
        
        setInterval(checkLoggedIn, 10000);
    </script>
</head>
<body>

    <div id="header">
        
        <div id="login">
            <form id="loginForm">
                <input name="name" type="text"/>
                <input name="pw" type="password"/>
                <input id="performLogin" value="Login" type="submit"/>
            </form>
        </div>
        <div id="status">
            <a href="#" onclick="performLogout()"></a>
        </div>
        <h1><a href="/" onclick="toggleWorking()">Polly Webinterface v2</a></h1>
    </div>
    
    
    #parse("index.menu.html")
    
    
    <div id="content">
        <h2>Welcome to Polly Webinterface v2</h2>
    </div>
    

</body>
</html>