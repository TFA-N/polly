#set ($dir = !$dir)

<h3>Total drop for shown reports</h3>
<table>
	<tr>
	#foreach ($drop in $totalDrop)
		<th>$!drop.getRessource()</th>
	#end
	</tr>
    <tr>
        <th colspan="14">Total drop</th>
    </tr>
	<tr>
	#foreach ($drop in $totalDrop)
		<td style="text-align:right;">$!drop.getAmount()</td>
	#end
	</tr>
    <tr>
        <th colspan="14">Average drop</th>
    </tr>
	<tr>
	#foreach ($drop in $totalDrop)
#set ($ratio = $drop.getAmount()/$reports.size())
		<td style="text-align:right;">$!ratio</td>
	#end
	</tr>
    <tr>
        <th colspan="14">Max drop</th>
    </tr>
	<tr>
	#foreach ($drop in $dropMax)
		<td style="text-align:right;">$!drop.getAmount()</td>
	#end
	</tr>
    <tr>
        <th colspan="14">Min drop</th>
    </tr>
	<tr>
	#foreach ($drop in $dropMin)
		<td style="text-align:right;">$!drop.getAmount()</td>
	#end
	</tr>
</table>

<p>
<b>Artifacts:</b> $artifacts<br/>
<b>Chance:</b> $myPolly.formatting().formatNumber($chance)
</p>

<h3>Statistics for shown reports</h3>
<table style="width:auto">
    <tr>
        <th>Total attacker Captain XP</th>
        <td style="text-align:right;">$!capiXpSumAttacker</td>
    </tr>
    <tr>
        <th>Total attacker Crew XP</th>
        <td style="text-align:right;">$!crewXpSumAttacker</td>
    </tr>
    <tr>
        <th>Total defender Captain XP</th>
        <td style="text-align:right;">$!capiXpSumDefender</td>
    </tr>
    <tr>
        <th>Total defender Crew XP</th>
        <td style="text-align:right;">$!crewXpSumDefender</td>
    </tr>
    <tr>
        <th>Total attacker PZ damage </th>
        <td style="text-align:right;">$!pzDamageAttacker</td>
    </tr>
    <tr>
        <th>Total defender PZ damage </th>
        <td style="text-align:right;">$!pzDamageDefender</td>
    </tr>
</table>

<h3>Active Filters</h3>
<table style="width: auto;">
    <tr>
        <th>Filter name</th>
        <th>Filter value</th>
        <th>Settings</th>
    </tr>
    <tr>
        <td>Chaining method:</td>
        <td>$FILTER_SETTINGS.getChainingMethod()</td>
        <td><a href="filter_reports?action=or">OR</a> | <a href="filter_reports?action=and">AND</a></td>
    </tr>
    <tr>
        <td>Switch alien Attacks</td>
        <td>$FILTER_SETTINGS.isSwitchOnAlienAttack()</td>
        <td><a href="filter_reports?action=toggleSwitching">Toggle</a></td>
    </tr>
    #foreach ($entry in $FILTER_SETTINGS.filterSet())
    <tr>
        <td>$entry.getKey()</td>
        <td>$entry.getValue().toString($myPolly.formatting())</td>
        <td><a href="filter_reports?action=removeFilter&filterKey=$entry.getKey()">Remove</a></td>
    </tr>
    #end
    <tr>
        <td></td>
        <td></td>
        <td><a href="filter_reports?action=clear">Clear all Filters</a></td>
    </tr>
</table>



#if ($sortKey && $reports)
    $sorter.sort($reports, $sortKey, $dir)
#end


<h3>Reports ($!reports.size())</h3>
<p style="font-size:xx-small; font-weight:bold">(Click Id for detailed info)</p>

<form action="filter_reports" method="POST">
<input type="hidden" name="action" value="idSelect"/>
<input type="submit" value="Statistic for selected" name="select" class="button"/>
<input type="submit" value="Delete selected" name="delete" class="button"/>
<table>
	<tr>
        <th><input type="checkbox" name="blah" disabled></th>
		<th><a href="$target&sortKey=getId&dir=$dir">Id</a></th>
		<th><a href="$target&sortKey=getQuadrant&dir=$dir">Quadrant</a></th>
		<th><a href="$target&sortKey=getAttackerVenadName&dir=$dir">Attacker</a></th>
		<th><a href="$target&sortKey=getAttackerClan&dir=$dir">Attacker Clan</a></th>
		<th><a href="$target&sortKey=getAttackerKw&dir=$dir">Attacker KW/Xp-Mod</a></th>
		<th><a href="$target&sortKey=getDefenderVenadName&dir=$dir">Defender</a></th>
		<th><a href="$target&sortKey=getDefenderClan&dir=$dir">Defender Clan</a></th>
		<th><a href="$target&sortKey=getDefenderKw&dir=$dir">Defender KW/Xp-Mod</a></th>
		<th><a href="$target&sortKey=getTactic&dir=$dir">Tactic</a></th>
		<th><a href="$target&sortKey=hasArtifact&dir=$dir">Artifact</a></th>
		<th><a href="$target&sortKey=getDate&dir=$dir">Date</a></th>
	</tr>
	#foreach ($report in $reports)
	<tr>
        <td><input type="checkbox" value="$report.getId()" name="selectRP"/></td>
		<td><a href="battlereport_info?id=$report.getId()">$report.getId()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=LOCATION_FILTER&param=$report.getQuadrant()">$report.getQuadrant()</a> $report.getX(),$report.getY()</td>
		<td><a href="filter_reports?action=addFilter&filterKey=ATTACKER_FILTER&param=$report.getAttackerVenadName()">$report.getAttackerVenadName()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=ATTACKER_CLAN_FILTER&param=$report.getAttackerClan()">$!report.getAttackerClan()</a></td>
		<td>$myPolly.formatting().formatNumber($report.getAttackerKw()) / $myPolly.formatting().formatNumber($report.getAttackerXpMod())</td>
		<td><a href="filter_reports?action=addFilter&filterKey=DEFENDER_FILTER&param=$report.getDefenderVenadName()">$report.getDefenderVenadName()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=DEFENDER_CLAN_FILTER&param==$report.getDefenderClan()">$!report.getDefenderClan()</a></td>
		<td>$myPolly.formatting().formatNumber($report.getDefenderKw()) / $myPolly.formatting().formatNumber($report.getDefenderXpMod())</td>
		<td><a href="filter_reports?action=addFilter&filterKey=TACTIC_FILTER&param=$report.getTactic()">$report.getTactic()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=HAS_ARTIFACT_FILTER">$report.hasArtifact()</a></td>
		<td><a href="filter_reports?action=addFilter&filterKey=DATE_FILTER&param=$myPolly.formatting().formatDate($report.getDate())">$myPolly.formatting().formatDate($report.getDate())</a></td>
	</tr>
	#end
</table>
<input type="submit" value="Statistic for selected" name="select" class="button"/>
<input type="submit" value="Delete selected" name="delete" class="button"/>
</form>